<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="749px" preserveAspectRatio="none" style="width:1103px;height:749px;" version="1.1" viewBox="0 0 1103 749" width="1103px" zoomAndPan="magnify"><defs><filter height="300%" id="f1ugjprwk8gk7e" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#000000" filter="url(#f1ugjprwk8gk7e)" height="304.4609" style="stroke: #000000; stroke-width: 1.0;" width="10" x="345.5" y="160.5625"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="179" x2="179" y1="86.2969" y2="662.6875"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="350" x2="350" y1="86.2969" y2="662.6875"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="857" x2="857" y1="86.2969" y2="662.6875"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="944" x2="944" y1="86.2969" y2="662.6875"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1040" x2="1040" y1="86.2969" y2="662.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="161" y="82.9951">User</text><ellipse cx="179.5" cy="13" fill="#000000" filter="url(#f1ugjprwk8gk7e)" rx="8" ry="8" style="stroke: #000000; stroke-width: 2.0;"/><path d="M179.5,21 L179.5,48 M166.5,29 L192.5,29 M179.5,48 L166.5,63 M179.5,48 L192.5,63 " fill="none" filter="url(#f1ugjprwk8gk7e)" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="161" y="674.6826">User</text><ellipse cx="179.5" cy="687.9844" fill="#000000" filter="url(#f1ugjprwk8gk7e)" rx="8" ry="8" style="stroke: #000000; stroke-width: 2.0;"/><path d="M179.5,695.9844 L179.5,722.9844 M166.5,703.9844 L192.5,703.9844 M179.5,722.9844 L166.5,737.9844 M179.5,722.9844 L192.5,737.9844 " fill="none" filter="url(#f1ugjprwk8gk7e)" style="stroke: #000000; stroke-width: 2.0;"/><rect fill="#FFFFFF" filter="url(#f1ugjprwk8gk7e)" height="30.2969" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.5;" width="157" x="270" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="277" y="70.9951">Account Web Client</text><rect fill="#FFFFFF" filter="url(#f1ugjprwk8gk7e)" height="30.2969" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.5;" width="157" x="270" y="661.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="277" y="681.6826">Account Web Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="820" y="82.9951">MongoDB</text><path d="M839.5,34 C839.5,24 857.5,24 857.5,24 C857.5,24 875.5,24 875.5,34 L875.5,60 C875.5,70 857.5,70 857.5,70 C857.5,70 839.5,70 839.5,60 L839.5,34 " fill="#FEFECE" filter="url(#f1ugjprwk8gk7e)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M839.5,34 C839.5,44 857.5,44 857.5,44 C857.5,44 875.5,44 875.5,34 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="820" y="674.6826">MongoDB</text><path d="M839.5,687.9844 C839.5,677.9844 857.5,677.9844 857.5,677.9844 C857.5,677.9844 875.5,677.9844 875.5,687.9844 L875.5,713.9844 C875.5,723.9844 857.5,723.9844 857.5,723.9844 C857.5,723.9844 839.5,723.9844 839.5,713.9844 L839.5,687.9844 " fill="#FEFECE" filter="url(#f1ugjprwk8gk7e)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M839.5,687.9844 C839.5,697.9844 857.5,697.9844 857.5,697.9844 C857.5,697.9844 875.5,697.9844 875.5,687.9844 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1ugjprwk8gk7e)" height="30.2969" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.5;" width="75" x="905" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="912" y="70.9951">Connect</text><rect fill="#FFFFFF" filter="url(#f1ugjprwk8gk7e)" height="30.2969" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.5;" width="75" x="905" y="661.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="912" y="681.6826">Connect</text><rect fill="#FFFFFF" filter="url(#f1ugjprwk8gk7e)" height="30.2969" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.5;" width="88" x="994" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="1001" y="70.9951">Profile API</text><rect fill="#FFFFFF" filter="url(#f1ugjprwk8gk7e)" height="30.2969" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.5;" width="88" x="994" y="661.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="1001" y="681.6826">Profile API</text><rect fill="#000000" filter="url(#f1ugjprwk8gk7e)" height="304.4609" style="stroke: #000000; stroke-width: 1.0;" width="10" x="345.5" y="160.5625"/><rect fill="#EEEEEE" filter="url(#f1ugjprwk8gk7e)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1088" x="3" y="116.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1091" y1="116.8633" y2="116.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1091" y1="119.8633" y2="119.8633"/><rect fill="#EEEEEE" filter="url(#f1ugjprwk8gk7e)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="146" x="474" y="106.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="127" x="480" y="122.3638">Add new identity</text><polygon fill="#000000" points="333.5,156.5625,343.5,160.5625,333.5,164.5625,337.5,160.5625" style="stroke: #000000; stroke-width: 1.0;"/><line style="stroke: #000000; stroke-width: 1.0;" x1="179.5" x2="339.5" y1="160.5625" y2="160.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="186.5" y="155.4966">Input identity value</text><polygon fill="#000000" points="845.5,198.2617,855.5,202.2617,845.5,206.2617,849.5,202.2617" style="stroke: #000000; stroke-width: 1.0;"/><line style="stroke: #000000; stroke-width: 1.0;" x1="355.5" x2="851.5" y1="202.2617" y2="202.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="362.5" y="197.1958">Insert temporary identity with the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="189" x="582.5" y="197.1958">insertTemporaryIdentity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="775.5" y="197.1958">command</text><path d="M29,176.0625 L29,211.0625 A2.5,2.5 0 0 0 31.5,213.5625 L333.5,213.5625 A2.5,2.5 0 0 0 336,211.0625 L336,183.5625 L326,173.5625 L31.5,173.5625 A2.5,2.5 0 0 0 29,176.0625 " fill="#FFFFFF" filter="url(#f1ugjprwk8gk7e)" style="stroke: #000000; stroke-width: 1.0;"/><path d="M326,173.5625 L326,182.3125 A1.25,1.25 0 0 0 327.25,183.5625 L336,183.5625 L326,173.5625 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="35" y="190.6294">The command is called with the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64" x="243" y="190.6294">user sub</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="307" y="190.6294">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="35" y="205.7622">the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="145" x="60" y="205.7622">temporary identity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="209" y="205.7622">and a</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="68" x="249" y="205.7622">DB client</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="317" y="205.7622">.</text><polygon fill="#000000" points="932.5,252.5273,942.5,256.5273,932.5,260.5273,936.5,256.5273" style="stroke: #000000; stroke-width: 1.0;"/><line style="stroke: #000000; stroke-width: 1.0;" x1="355.5" x2="938.5" y1="256.5273" y2="256.5273"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="290" x="362.5" y="251.4614">Trigger the sendIdentityValidationCode query</text><path d="M22,230.3281 L22,265.3281 A2.5,2.5 0 0 0 24.5,267.8281 L333.5,267.8281 A2.5,2.5 0 0 0 336,265.3281 L336,237.8281 L326,227.8281 L24.5,227.8281 A2.5,2.5 0 0 0 22,230.3281 " fill="#FFFFFF" filter="url(#f1ugjprwk8gk7e)" style="stroke: #000000; stroke-width: 1.0;"/><path d="M326,227.8281 L326,236.5781 A1.25,1.25 0 0 0 327.25,237.8281 L336,237.8281 L326,227.8281 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="28" y="244.895">The query takes a</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="148" y="244.895">callbackUrl</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29" x="229" y="244.895">, the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="59" x="262" y="244.895">identity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="28" y="260.0278">the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="53" y="260.0278">localeOverride</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="165" y="260.0278">and the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="47" x="218" y="260.0278">userId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="265" y="260.0278">.</text><polygon fill="#000000" points="333.5,294.2266,343.5,298.2266,333.5,302.2266,337.5,298.2266" style="stroke: #000000; stroke-width: 1.0;"/><line style="stroke: #000000; stroke-width: 1.0;" x1="179.5" x2="339.5" y1="298.2266" y2="298.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="186.5" y="293.1606">Input verification code</text><polygon fill="#000000" points="932.5,335.9258,942.5,339.9258,932.5,343.9258,936.5,339.9258" style="stroke: #000000; stroke-width: 1.0;"/><line style="stroke: #000000; stroke-width: 1.0;" x1="355.5" x2="938.5" y1="339.9258" y2="339.9258"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="257" x="362.5" y="334.8599">Trigger the checkVerificationCode query</text><path d="M8,313.7266 L8,348.7266 A2.5,2.5 0 0 0 10.5,351.2266 L334.5,351.2266 A2.5,2.5 0 0 0 337,348.7266 L337,321.2266 L327,311.2266 L10.5,311.2266 A2.5,2.5 0 0 0 8,313.7266 " fill="#FFFFFF" filter="url(#f1ugjprwk8gk7e)" style="stroke: #000000; stroke-width: 1.0;"/><path d="M327,311.2266 L327,319.9766 A1.25,1.25 0 0 0 328.25,321.2266 L337,321.2266 L327,311.2266 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="14" y="328.2935">The query is called with the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="194" y="328.2935">verification code</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="18" y="343.4263">and the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="61" x="71" y="343.4263">event id</text><polygon fill="#000000" points="845.5,377.625,855.5,381.625,845.5,385.625,849.5,381.625" style="stroke: #000000; stroke-width: 1.0;"/><line style="stroke: #000000; stroke-width: 1.0;" x1="355.5" x2="851.5" y1="381.625" y2="381.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="367" x="362.5" y="376.5591">Query back temporary identity and verify expiration date</text><polygon fill="#000000" points="932.5,419.3242,942.5,423.3242,932.5,427.3242,936.5,423.3242" style="stroke: #000000; stroke-width: 1.0;"/><line style="stroke: #000000; stroke-width: 1.0;" x1="355.5" x2="938.5" y1="423.3242" y2="423.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="362.5" y="418.2583">Trigger the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="142" x="436.5" y="418.2583">addIdentityToUser</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="582.5" y="418.2583">mutation</text><path d="M57,397.125 L57,432.125 A2.5,2.5 0 0 0 59.5,434.625 L333.5,434.625 A2.5,2.5 0 0 0 336,432.125 L336,404.625 L326,394.625 L59.5,394.625 A2.5,2.5 0 0 0 57,397.125 " fill="#FFFFFF" filter="url(#f1ugjprwk8gk7e)" style="stroke: #000000; stroke-width: 1.0;"/><path d="M326,394.625 L326,403.375 A1.25,1.25 0 0 0 327.25,404.625 L336,404.625 L326,394.625 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="63" y="411.6919">The mutation is called with the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="264" y="411.6919">user_id</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="317" y="411.6919">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="63" y="426.8247">identity</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="115" y="426.8247">value</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="158" y="426.8247">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="34" x="186" y="426.8247">type</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="220" y="426.8247">.</text><polygon fill="#000000" points="845.5,461.0234,855.5,465.0234,845.5,469.0234,849.5,465.0234" style="stroke: #000000; stroke-width: 1.0;"/><line style="stroke: #000000; stroke-width: 1.0;" x1="350.5" x2="851.5" y1="465.0234" y2="465.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="357.5" y="459.9575">Delete temporary identity</text><rect fill="#EEEEEE" filter="url(#f1ugjprwk8gk7e)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1088" x="3" y="493.5898"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1091" y1="493.5898" y2="493.5898"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1091" y1="496.5898" y2="496.5898"/><rect fill="#EEEEEE" filter="url(#f1ugjprwk8gk7e)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="133" x="480.5" y="483.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="486.5" y="499.0903">Delete identity</text><polygon fill="#000000" points="932.5,545.8555,942.5,549.8555,932.5,553.8555,936.5,549.8555" style="stroke: #000000; stroke-width: 1.0;"/><line style="stroke: #000000; stroke-width: 1.0;" x1="350.5" x2="938.5" y1="549.8555" y2="549.8555"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="357.5" y="544.7896">Run</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="191" x="386.5" y="544.7896">removeIdentityFromUser</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="581.5" y="544.7896">mutation.</text><path d="M62,523.6563 L62,558.6563 A2.5,2.5 0 0 0 64.5,561.1563 L338.5,561.1563 A2.5,2.5 0 0 0 341,558.6563 L341,531.1563 L331,521.1563 L64.5,521.1563 A2.5,2.5 0 0 0 62,523.6563 " fill="#FFFFFF" filter="url(#f1ugjprwk8gk7e)" style="stroke: #000000; stroke-width: 1.0;"/><path d="M331,521.1563 L331,529.9063 A1.25,1.25 0 0 0 332.25,531.1563 L341,531.1563 L331,521.1563 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="68" y="538.2231">The mutation is called with the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="269" y="538.2231">user_id</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="322" y="538.2231">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="68" y="553.356">identity</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="120" y="553.356">value</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="163" y="553.356">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="34" x="191" y="553.356">type</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="225" y="553.356">.</text><rect fill="#EEEEEE" filter="url(#f1ugjprwk8gk7e)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1088" x="3" y="590.9883"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1091" y1="590.9883" y2="590.9883"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1091" y1="593.9883" y2="593.9883"/><rect fill="#EEEEEE" filter="url(#f1ugjprwk8gk7e)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="137" x="478.5" y="580.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="484.5" y="596.4888">Update identity</text><path d="M134,621.0547 L134,641.0547 A2.5,2.5 0 0 0 136.5,643.5547 L983.5,643.5547 A2.5,2.5 0 0 0 986,641.0547 L986,628.5547 L976,618.5547 L136.5,618.5547 A2.5,2.5 0 0 0 134,621.0547 " fill="#FFFFFF" filter="url(#f1ugjprwk8gk7e)" style="stroke: #000000; stroke-width: 1.0;"/><path d="M976,618.5547 L976,627.3047 A1.25,1.25 0 0 0 977.25,628.5547 L986,628.5547 L976,618.5547 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="831" x="140" y="635.6216">The update identity flow is a mix between the two above, starting with the add identity, and delete is the first sequence succeed.</text><!--MD5=[40720028e52eece42777567b901c0bb3]
@startuml
skinparam NoteBackgroundColor #fff
skinparam NoteBorderColor #000

skinparam sequence {
	ArrowColor #000
	ActorBorderColor #000

	LifeLineBorderColor #000
	LifeLineBackgroundColor #000

	ParticipantBorderColor #000
	ParticipantBackgroundColor #fff
	ParticipantFontColor #000

	ActorBackgroundColor #000
	ActorFontColor #000

        NoteBorderColor #000
}

skinparam roundcorner 5

actor User                         as user
participant "Account Web Client"   as account
database MongoDB                   as mongo
participant "Connect"              as connect
participant "Profile API"          as profile

== Add new identity ==

user -> account : Input identity value
activate account
account -> mongo : Insert temporary identity with the **insertTemporaryIdentity** command
note left
The command is called with the **user sub**,
the **temporary identity** and a **DB client**.
end note
account -> connect : Trigger the sendIdentityValidationCode query
note left
The query takes a **callbackUrl**, the **identity**
the **localeOverride** and the **userId**.
end note
user -> account : Input verification code
account -> connect : Trigger the checkVerificationCode query
note left
The query is called with the **verification code**
 and the **event id**
end note
account -> mongo : Query back temporary identity and verify expiration date
account -> connect : Trigger the **addIdentityToUser** mutation
note left
The mutation is called with the **user_id**,
identity **value** and **type**.
end note
account -> mongo : Delete temporary identity
deactivate account

== Delete identity ==

account -> connect : Run **removeIdentityFromUser** mutation.
note left
The mutation is called with the **user_id**,
identity **value** and **type**.
end note

== Update identity ==

note over user, connect
The update identity flow is a mix between the two above, starting with the add identity, and delete is the first sequence succeed.
end note
@enduml

PlantUML version 1.2020.17(Sat Sep 19 12:30:11 UTC 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>