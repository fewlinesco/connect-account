<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="868px" preserveAspectRatio="none" style="width:923px;height:868px;" version="1.1" viewBox="0 0 923 868" width="923px" zoomAndPan="magnify"><defs><filter height="300%" id="f1415f7p6dchrj" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#000000" filter="url(#f1415f7p6dchrj)" height="409.2578" style="stroke:#000000;stroke-width:1.0;" width="10" x="226.5" y="162.5625"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="60" x2="60" y1="88.2969" y2="784.6172"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="231" x2="231" y1="88.2969" y2="784.6172"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="762.5" x2="762.5" y1="88.2969" y2="784.6172"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="854.5" x2="854.5" y1="88.2969" y2="784.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="42" y="84.9951">User</text><ellipse cx="60.5" cy="15" fill="#000000" filter="url(#f1415f7p6dchrj)" rx="8" ry="8" style="stroke:#000000;stroke-width:2.0;"/><path d="M60.5,23 L60.5,50 M47.5,31 L73.5,31 M60.5,50 L47.5,65 M60.5,50 L73.5,65 " fill="none" filter="url(#f1415f7p6dchrj)" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="42" y="796.6123">User</text><ellipse cx="60.5" cy="809.9141" fill="#000000" filter="url(#f1415f7p6dchrj)" rx="8" ry="8" style="stroke:#000000;stroke-width:2.0;"/><path d="M60.5,817.9141 L60.5,844.9141 M47.5,825.9141 L73.5,825.9141 M60.5,844.9141 L47.5,859.9141 M60.5,844.9141 L73.5,859.9141 " fill="none" filter="url(#f1415f7p6dchrj)" style="stroke:#000000;stroke-width:2.0;"/><rect fill="#FFFFFF" filter="url(#f1415f7p6dchrj)" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.5;" width="157" x="151" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="158" y="72.9951">Account Web Client</text><rect fill="#FFFFFF" filter="url(#f1415f7p6dchrj)" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.5;" width="157" x="151" y="783.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="158" y="803.6123">Account Web Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="719.5" y="84.9951">DynamoDB</text><path d="M744.5,36 C744.5,26 762.5,26 762.5,26 C762.5,26 780.5,26 780.5,36 L780.5,62 C780.5,72 762.5,72 762.5,72 C762.5,72 744.5,72 744.5,62 L744.5,36 " fill="#FEFECE" filter="url(#f1415f7p6dchrj)" style="stroke:#000000;stroke-width:1.5;"/><path d="M744.5,36 C744.5,46 762.5,46 762.5,46 C762.5,46 780.5,46 780.5,36 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="719.5" y="796.6123">DynamoDB</text><path d="M744.5,809.9141 C744.5,799.9141 762.5,799.9141 762.5,799.9141 C762.5,799.9141 780.5,799.9141 780.5,809.9141 L780.5,835.9141 C780.5,845.9141 762.5,845.9141 762.5,845.9141 C762.5,845.9141 744.5,845.9141 744.5,835.9141 L744.5,809.9141 " fill="#FEFECE" filter="url(#f1415f7p6dchrj)" style="stroke:#000000;stroke-width:1.5;"/><path d="M744.5,809.9141 C744.5,819.9141 762.5,819.9141 762.5,819.9141 C762.5,819.9141 780.5,819.9141 780.5,809.9141 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><rect fill="#FFFFFF" filter="url(#f1415f7p6dchrj)" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.5;" width="75" x="815.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="822.5" y="72.9951">Connect</text><rect fill="#FFFFFF" filter="url(#f1415f7p6dchrj)" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.5;" width="75" x="815.5" y="783.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="822.5" y="803.6123">Connect</text><rect fill="#000000" filter="url(#f1415f7p6dchrj)" height="409.2578" style="stroke:#000000;stroke-width:1.0;" width="10" x="226.5" y="162.5625"/><rect fill="#EEEEEE" filter="url(#f1415f7p6dchrj)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="916" x="0" y="118.8633"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="916" y1="118.8633" y2="118.8633"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="916" y1="121.8633" y2="121.8633"/><rect fill="#EEEEEE" filter="url(#f1415f7p6dchrj)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="147" x="384.5" y="108.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="390.5" y="124.3638">Add new Identity</text><polygon fill="#000000" points="214.5,158.5625,224.5,162.5625,214.5,166.5625,218.5,162.5625" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="60.5" x2="220.5" y1="162.5625" y2="162.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="67.5" y="157.4966">Input Identity value</text><polygon fill="#000000" points="843,215.3945,853,219.3945,843,223.3945,847,219.3945" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="236.5" x2="849" y1="219.3945" y2="219.3945"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="243.5" y="214.3286">Trigger the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="209" x="317.5" y="214.3286">sendIdentityValidationCode</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="530.5" y="214.3286">query</text><path d="M95,178.0625 L95,243.0625 A2.5,2.5 0 0 0 97.5,245.5625 L214.5,245.5625 A2.5,2.5 0 0 0 217,243.0625 L217,185.5625 L207,175.5625 L97.5,175.5625 A2.5,2.5 0 0 0 95,178.0625 " fill="#FFFFFF" filter="url(#f1415f7p6dchrj)" style="stroke:#000000;stroke-width:1.0;"/><path d="M207,175.5625 L207,184.3125 A1.25,1.25 0 0 0 208.25,185.5625 L217,185.5625 L207,175.5625 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="101" y="192.6294">- callbackUrl</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="101" y="207.7622">- identity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="101" y="222.895">- localeOverride</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="101" y="238.0278">- userId</text><polygon fill="#000000" points="247.5,272.2266,237.5,276.2266,247.5,280.2266,243.5,276.2266" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="241.5" x2="854" y1="276.2266" y2="276.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="253.5" y="271.1606">Returns</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="307.5" y="271.1606">callbackUrl</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="388.5" y="271.1606">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="57" x="396.5" y="271.1606">eventId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="453.5" y="271.1606">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="461.5" y="271.1606">localeCode</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="547.5" y="271.1606">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="54" x="575.5" y="271.1606">nounce</text><polygon fill="#000000" points="750.5,329.0586,760.5,333.0586,750.5,337.0586,754.5,333.0586" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="236.5" x2="756.5" y1="333.0586" y2="333.0586"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="243.5" y="327.9927">Insert</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="283.5" y="327.9927">TemporaryIdentity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="431.5" y="327.9927">with the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="189" x="487.5" y="327.9927">insertTemporaryIdentity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="680.5" y="327.9927">command</text><path d="M126,291.7266 L126,356.7266 A2.5,2.5 0 0 0 128.5,359.2266 L214.5,359.2266 A2.5,2.5 0 0 0 217,356.7266 L217,299.2266 L207,289.2266 L128.5,289.2266 A2.5,2.5 0 0 0 126,291.7266 " fill="#FFFFFF" filter="url(#f1415f7p6dchrj)" style="stroke:#000000;stroke-width:1.0;"/><path d="M207,289.2266 L207,297.9766 A1.25,1.25 0 0 0 208.25,299.2266 L217,299.2266 L207,289.2266 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="132" y="306.2935">- eventId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="132" y="321.4263">- value</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="132" y="336.5591">- type</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="132" y="351.6919">- expiresAt</text><polygon fill="#000000" points="214.5,385.8906,224.5,389.8906,214.5,393.8906,218.5,389.8906" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="60.5" x2="220.5" y1="389.8906" y2="389.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="67.5" y="384.8247">Input verification code</text><polygon fill="#000000" points="843,427.5898,853,431.5898,843,435.5898,847,431.5898" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="236.5" x2="849" y1="431.5898" y2="431.5898"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="243.5" y="426.5239">Trigger the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="317.5" y="426.5239">checkVerificationCode</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="491.5" y="426.5239">query</text><path d="M81,405.3906 L81,440.3906 A2.5,2.5 0 0 0 83.5,442.8906 L214.5,442.8906 A2.5,2.5 0 0 0 217,440.3906 L217,412.8906 L207,402.8906 L83.5,402.8906 A2.5,2.5 0 0 0 81,405.3906 " fill="#FFFFFF" filter="url(#f1415f7p6dchrj)" style="stroke:#000000;stroke-width:1.0;"/><path d="M207,402.8906 L207,411.6406 A1.25,1.25 0 0 0 208.25,412.8906 L217,412.8906 L207,402.8906 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="87" y="419.9575">- verification code</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="87" y="435.0903">- event id</text><polygon fill="#000000" points="750.5,469.2891,760.5,473.2891,750.5,477.2891,754.5,473.2891" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="236.5" x2="756.5" y1="473.2891" y2="473.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="243.5" y="468.2231">Query back</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="320.5" y="468.2231">TemporaryIdentity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="468.5" y="468.2231">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="496.5" y="468.2231">verify</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="543.5" y="468.2231">expiration date</text><polygon fill="#000000" points="843,518.5547,853,522.5547,843,526.5547,847,522.5547" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="236.5" x2="849" y1="522.5547" y2="522.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="243.5" y="517.4888">Trigger the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="142" x="317.5" y="517.4888">addIdentityToUser</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="463.5" y="517.4888">mutation</text><path d="M141,488.7891 L141,538.7891 A2.5,2.5 0 0 0 143.5,541.2891 L214.5,541.2891 A2.5,2.5 0 0 0 217,538.7891 L217,496.2891 L207,486.2891 L143.5,486.2891 A2.5,2.5 0 0 0 141,488.7891 " fill="#FFFFFF" filter="url(#f1415f7p6dchrj)" style="stroke:#000000;stroke-width:1.0;"/><path d="M207,486.2891 L207,495.0391 A1.25,1.25 0 0 0 208.25,496.2891 L217,496.2891 L207,486.2891 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="147" y="503.356">- user_id</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="147" y="518.4888">- value</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="147" y="533.6216">- type</text><polygon fill="#000000" points="750.5,567.8203,760.5,571.8203,750.5,575.8203,754.5,571.8203" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="231.5" x2="756.5" y1="571.8203" y2="571.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="238.5" y="566.7544">Delete</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="284.5" y="566.7544">TemporaryIdentity</text><rect fill="#EEEEEE" filter="url(#f1415f7p6dchrj)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="916" x="0" y="600.3867"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="916" y1="600.3867" y2="600.3867"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="916" y1="603.3867" y2="603.3867"/><rect fill="#EEEEEE" filter="url(#f1415f7p6dchrj)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="134" x="391" y="589.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="397" y="605.8872">Delete Identity</text><polygon fill="#000000" points="843,660.2188,853,664.2188,843,668.2188,847,664.2188" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="231.5" x2="849" y1="664.2188" y2="664.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="238.5" y="659.1528">Trigger</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="191" x="287.5" y="659.1528">removeIdentityFromUser</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="482.5" y="659.1528">mutation</text><path d="M146,630.4531 L146,680.4531 A2.5,2.5 0 0 0 148.5,682.9531 L219.5,682.9531 A2.5,2.5 0 0 0 222,680.4531 L222,637.9531 L212,627.9531 L148.5,627.9531 A2.5,2.5 0 0 0 146,630.4531 " fill="#FFFFFF" filter="url(#f1415f7p6dchrj)" style="stroke:#000000;stroke-width:1.0;"/><path d="M212,627.9531 L212,636.7031 A1.25,1.25 0 0 0 213.25,637.9531 L222,637.9531 L212,627.9531 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="152" y="645.02">- user_id</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="152" y="660.1528">- value</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="152" y="675.2856">- type</text><rect fill="#EEEEEE" filter="url(#f1415f7p6dchrj)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="916" x="0" y="712.918"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="916" y1="712.918" y2="712.918"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="916" y1="715.918" y2="715.918"/><rect fill="#EEEEEE" filter="url(#f1415f7p6dchrj)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="138" x="389" y="702.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="119" x="395" y="718.4185">Update Identity</text><path d="M5,742.9844 L5,762.9844 A2.5,2.5 0 0 0 7.5,765.4844 L904.5,765.4844 A2.5,2.5 0 0 0 907,762.9844 L907,750.4844 L897,740.4844 L7.5,740.4844 A2.5,2.5 0 0 0 5,742.9844 " fill="#FFFFFF" filter="url(#f1415f7p6dchrj)" style="stroke:#000000;stroke-width:1.0;"/><path d="M897,740.4844 L897,749.2344 A1.25,1.25 0 0 0 898.25,750.4844 L907,750.4844 L897,740.4844 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="881" x="11" y="757.5513">The update Identity flow is a mix between the two above, starting with the add Identity, and delete Identity if the first sequence succeed.</text><!--MD5=[5e907eeb24ee3e3d2a3b540573bed835]
@startuml
skinparam NoteBackgroundColor #fff
skinparam NoteBorderColor #000

skinparam sequence {
	ArrowColor #000
	ActorBorderColor #000

	LifeLineBorderColor #000
	LifeLineBackgroundColor #000

	ParticipantBorderColor #000
	ParticipantBackgroundColor #fff
	ParticipantFontColor #000

	ActorBackgroundColor #000
	ActorFontColor #000

  NoteBorderColor #000
}

skinparam roundcorner 5

actor User                         as user
participant "Account Web Client"   as account
database DynamoDB                   as dynamo
participant "Connect"              as connect

== Add new Identity ==

user -> account : Input Identity value
activate account
account -> connect : Trigger the **sendIdentityValidationCode** query
note left
- callbackUrl
- identity
- localeOverride
- userId
end note
connect -> account : Returns **callbackUrl**, **eventId**, **localeCode** and **nounce**
account -> dynamo : Insert **TemporaryIdentity** with the **insertTemporaryIdentity** command
note left
- eventId
- value
- type
- expiresAt
end note
user -> account : Input verification code
account -> connect : Trigger the **checkVerificationCode** query
note left
- verification code
- event id
end note
account -> dynamo : Query back **TemporaryIdentity** and **verify** expiration date
account -> connect : Trigger the **addIdentityToUser** mutation
note left
- user_id
- value
- type
end note
account -> dynamo : Delete **TemporaryIdentity**
deactivate account

== Delete Identity ==

account -> connect : Trigger **removeIdentityFromUser** mutation
note left
- user_id
- value
- type
end note

== Update Identity ==

note over user, connect
The update Identity flow is a mix between the two above, starting with the add Identity, and delete Identity if the first sequence succeed.
end note
@enduml

PlantUML version 1.2020.22(Sun Dec 06 09:36:27 UTC 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>